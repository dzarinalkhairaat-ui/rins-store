<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="css/main.css">
    <style>
        /* --- STYLE KHUSUS ADMIN --- */
        .btn-header-icon {
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: #F8FAFC; width: 38px; height: 38px; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; font-size: 1.2rem;
        }
        .btn-header-icon:hover { background: rgba(255, 255, 255, 0.2); }
        .btn-header-icon.logout { background: rgba(239, 68, 68, 0.2); border-color: rgba(239, 68, 68, 0.4); color: #ef4444; }
        .btn-header-icon.logout:hover { background: rgba(239, 68, 68, 0.4); }

        .form-card { background: rgba(30, 41, 59, 0.6); padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .input-group { margin-bottom: 18px; }
        .input-label { display: block; color: #94A3B8; margin-bottom: 6px; font-size: 0.9rem; font-weight: 500; }
        .input-field { width: 100%; padding: 12px 15px; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; color: white; font-family: 'Inter'; outline: none; transition: 0.3s; }
        .input-field:focus { border-color: #22C55E; background: rgba(15, 23, 42, 0.9); }
        .hidden { display: none; }
        
        #linkMsg { font-size: 0.8rem; margin-top: 5px; }
        .text-green { color: #4ADE80; }
        .text-red { color: #ef4444; }

        .safety-check { display: flex; align-items: flex-start; gap: 12px; background: rgba(34, 197, 94, 0.1); padding: 15px; border-radius: 10px; border: 1px solid rgba(34, 197, 94, 0.3); margin-top: 10px; }
        .safety-check input { width: 20px; height: 20px; margin-top: 2px; accent-color: #22C55E; cursor: pointer; }
        .safety-check label { font-size: 0.85rem; color: #bbf7d0; line-height: 1.4; cursor: pointer; }

        .btn-add { background: linear-gradient(135deg, #22C55E 0%, #15803d 100%); color: white; border: none; width: 100%; padding: 16px; border-radius: 12px; margin-top: 20px; font-family: 'Poppins', sans-serif; font-weight: 600; font-size: 1rem; letter-spacing: 0.5px; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3); }
        .btn-add:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(34, 197, 94, 0.5); filter: brightness(1.1); }
        .btn-add:active { transform: scale(0.98); box-shadow: 0 2px 10px rgba(34, 197, 94, 0.3); }

        #cancelEditBtn { background: rgba(255, 255, 255, 0.1); margin-top: 10px; width: 100%; padding: 12px; border-radius: 12px; color: #94A3B8; border: 1px solid rgba(255,255,255,0.1); cursor: pointer; font-weight: 600; display: none; }
        #cancelEditBtn:hover { background: rgba(255, 255, 255, 0.2); color: white; }

        .table-responsive { overflow-x: auto; border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .product-table { width: 100%; border-collapse: collapse; background: rgba(30, 41, 59, 0.6); min-width: 350px; }
        .product-table th { background: rgba(15, 23, 42, 0.8); color: #A3B18A; padding: 15px; text-align: left; font-size: 0.85rem; border-bottom: 1px solid rgba(255,255,255,0.1); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .product-table td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); vertical-align: middle; }
        .td-img { width: 50px; height: 50px; object-fit: cover; border-radius: 8px; background: #1e293b; }
        .action-btn { width: 32px; height: 32px; border-radius: 8px; border: none; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; color: white; font-size: 1rem; transition: 0.2s; margin: 2px; }
        .action-btn.edit { background: rgba(245, 158, 11, 0.2); color: #fbbf24; border: 1px solid rgba(245, 158, 11, 0.3); } 
        .action-btn.edit:hover { background: #f59e0b; color: #0F172A; }
        .action-btn.delete { background: rgba(239, 68, 68, 0.2); color: #f87171; border: 1px solid rgba(239, 68, 68, 0.3); } 
        .action-btn.delete:hover { background: #ef4444; color: white; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; z-index: 200; }
        .modal-card { background: #1e293b; padding: 25px; border-radius: 20px; width: 90%; max-width: 400px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 25px 50px rgba(0,0,0,0.6); }
        .modal-actions { display: flex; gap: 10px; margin-top: 20px; }
        .btn-save-pass { flex: 1; background: #22C55E; color: #0F172A; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .btn-cancel-pass { flex: 1; background: rgba(255,255,255,0.1); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="container header-layout" style="justify-content: space-between;">
            <div class="brand-logo">Rins Admin</div>
            
            <div style="display: flex; gap: 8px;">
                <button onclick="openBannerModal()" class="btn-header-icon" title="Kelola Banner">
                    <i class="ph ph-image"></i>
                </button>
                
                <button onclick="openSettingsModal()" class="btn-header-icon" title="Pengaturan">
                    <i class="ph ph-gear"></i>
                </button>
                
                <button onclick="window.logout()" class="btn-header-icon logout" title="Keluar">
                    <i class="ph ph-sign-out"></i>
                </button>
            </div>
        </div>
    </header>

    <div class="container" style="padding-top: 80px;">
        
        <div class="form-card">
            <h4 id="formTitle" style="margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; font-family: 'Poppins'; font-size: 1.1rem; color: #F8FAFC;">
                <i class="ph ph-package-plus" style="color: #22C55E; margin-right: 8px;"></i> Tambah Produk
            </h4>
            
            <form id="addProductForm">
                <input type="hidden" id="editProductId"> 
                
                <div class="input-group">
                    <label class="input-label">Tipe Bisnis</label>
                    <select id="type" class="input-field">
                        <option value="dropship">Dropship (Stok Sendiri)</option>
                        <option value="affiliate">Affiliate (Link Luar)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label class="input-label">Nama Produk</label>
                    <input type="text" id="name" class="input-field" required placeholder="Contoh: Kaos Polos Premium">
                </div>

                <div class="input-group">
                    <label class="input-label">Harga (Rp)</label>
                    <input type="number" id="price" class="input-field" required placeholder="50000">
                </div>

                <div class="input-group">
                    <label class="input-label">Kategori</label>
                    <select id="category" class="input-field">
                        <option value="" disabled selected>Pilih Kategori...</option>
                        <option value="Fashion Pria">Fashion Pria</option>
                        <option value="Fashion Wanita">Fashion Wanita</option>
                        <option value="Skincare">Skincare</option>
                        <option value="Pulsa">Pulsa</option>
                        <option value="Top Up Game">Top Up Game</option>
                        <option value="Token Listrik">Token Listrik</option>
                        <option value="Ebook Digital">Ebook Digital</option>
                        <option value="Elektronik">Elektronik</option>
                        <option value="Aksesoris HP Laptop">Aksesoris HP & Laptop</option>
                        <option value="Emas">Emas</option>
                        <option value="Food & Drink">Food & Drink</option>
                    </select>
                </div>

                <div class="input-group" id="subCatGroup" style="display: none;">
                    <label class="input-label">Sub-Kategori</label>
                    <select id="subcategory" class="input-field">
                        <option value="">-- Pilih Subkategori --</option>
                    </select>
                </div>

                <div id="fashionFields" class="hidden" style="background: rgba(34, 197, 94, 0.05); padding: 15px; border-radius: 12px; border: 1px dashed rgba(34, 197, 94, 0.3); margin-bottom: 15px;">
                    <h5 style="color: #22C55E; margin-bottom: 15px; font-family: 'Poppins';">Khusus Fashion</h5>
                    <div class="input-group">
                        <label class="input-label">Pilihan Ukuran (Pisahkan koma)</label>
                        <input type="text" id="fashionSizes" class="input-field" placeholder="S, M, L, XL">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Pilihan Warna (Pisahkan koma)</label>
                        <input type="text" id="fashionColors" class="input-field" placeholder="Hitam, Putih, Navy">
                    </div>
                    <div class="input-group">
                        <label class="input-label">URL Gambar Size Chart</label>
                        <input type="text" id="sizeChartImage" class="input-field" placeholder="https://...">
                    </div>
                </div>

                <div id="dropshipFields" class="input-group">
                    <label class="input-label">Stok Barang</label>
                    <input type="number" id="stock" class="input-field" value="10">
                </div>

                <div id="affiliateFields" class="hidden">
                    <div class="input-group">
                        <label class="input-label">Platform</label>
                        <select id="affiliatePlatform" class="input-field">
                            <option value="shopee">Shopee</option>
                            <option value="tokopedia">Tokopedia</option>
                            <option value="tiktok">TikTok Shop</option>
                            <option value="other">Lainnya</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Link Produk</label>
                        <input type="url" id="affiliateLink" class="input-field" placeholder="https://...">
                        <div id="linkMsg"></div>
                    </div>
                </div>

                <div class="input-group">
                    <label class="input-label">URL Gambar Produk</label>
                    <input type="text" id="image" class="input-field" required placeholder="https://contoh.com/gambar.jpg">
                </div>

                <div class="input-group">
                    <label class="input-label">Deskripsi</label>
                    <textarea id="description" class="input-field" rows="4" placeholder="Jelaskan detail produk..."></textarea>
                </div>

                <button type="submit" id="submitBtn" class="btn-add">
                    <i class="ph ph-upload" style="font-size: 1.2rem;"></i> <span id="btnText">Upload Produk</span>
                </button>
                <button type="button" id="cancelEditBtn">
                    <i class="ph ph-x"></i> Batal Edit
                </button>
            </form>
        </div>

        <div style="margin-bottom: 50px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h4 style="font-family: 'Poppins'; color: #F8FAFC;">Daftar Produk</h4>
                <span style="font-size: 0.8rem; color: #94A3B8;">Geser tabel jika terpotong &rarr;</span>
            </div>
            <div class="table-responsive">
                <table class="product-table">
                    <thead><tr><th>Gambar</th><th>Nama & Kategori</th><th>Harga</th><th>Aksi</th></tr></thead>
                    <tbody id="adminProductList"></tbody>
                </table>
            </div>
        </div>

        <a href="index.html" style="display: block; text-align: center; margin-bottom: 100px; color: #A3B18A; text-decoration: none; font-weight: 500;">
            &larr; Kembali ke Toko
        </a>
    </div>

    <div id="settingsModal" class="modal-overlay">
        <div class="modal-card">
            <h3 style="margin-bottom: 20px; text-align: center; font-family: 'Poppins'; color: white;">Pengaturan Akun</h3>
            <div class="input-group"><label class="input-label">Email Admin</label><input type="email" id="editEmail" class="input-field"></div>
            <div class="input-group"><label class="input-label">WhatsApp Admin 1</label><input type="text" id="editWa1" class="input-field"></div>
            <div class="input-group"><label class="input-label">WhatsApp Admin 2</label><input type="text" id="editWa2" class="input-field"></div>
            <hr style="border: 0; border-top: 1px dashed rgba(255,255,255,0.1); margin: 20px 0;">
            <div class="input-group"><label class="input-label">Password Baru <span style="font-size:0.7rem; color:#64748b;">(Opsional)</span></label><input type="password" id="newPassword" class="input-field" placeholder="Minimal 6 karakter"></div>
            <div class="modal-actions"><button onclick="closeSettingsModal()" class="btn-cancel-pass">Batal</button><button onclick="saveSettings()" class="btn-save-pass">Simpan</button></div>
        </div>
    </div>

    <div id="bannerModal" class="modal-overlay">
        <div class="modal-card">
            <h3 style="margin-bottom: 20px; text-align: center; font-family: 'Poppins'; color: white;">Kelola Banner</h3>
            <div class="input-group">
                <label class="input-label">Pilih Posisi Banner</label>
                <select id="bannerSelector" class="input-field" onchange="loadBannerDataInModal()">
                    <option value="home_1">Home - Slide 1</option>
                    <option value="home_2">Home - Slide 2</option>
                    <option value="home_3">Home - Slide 3</option>
                    <option value="about_hero">Halaman Tentang Kami</option>
                    <option value="help_hero">Halaman Cara Belanja</option>
                </select>
            </div>
            <div class="input-group"><label class="input-label">URL Gambar</label><input type="text" id="bannerImage" class="input-field" placeholder="https://..."></div>
            <div id="homeBannerTexts">
                <div class="input-group"><label class="input-label">Judul Utama</label><input type="text" id="bannerTitle" class="input-field"></div>
                <div class="input-group"><label class="input-label">Sub-Judul</label><input type="text" id="bannerSubtitle" class="input-field"></div>
                <div class="input-group"><label class="input-label">Teks Tombol</label><input type="text" id="bannerBtnText" class="input-field"></div>
            </div>
            <div class="modal-actions"><button onclick="closeBannerModal()" class="btn-cancel-pass">Tutup</button><button onclick="saveBanner()" class="btn-save-pass">Simpan</button></div>
        </div>
    </div>

    <div id="confirmModal" class="modal-overlay">
        <div class="modal-card">
            <div style="text-align: center; margin-bottom: 15px;"><i class="ph ph-warning-circle" style="font-size: 3.5rem; color: #F59E0B;"></i></div>
            <h3 style="margin-bottom: 10px; text-align: center; color: #F59E0B; font-family: 'Poppins';">Konfirmasi Link</h3>
            <p style="text-align: center; color: #94A3B8; font-size: 0.9rem; margin-bottom: 20px;">Pastikan link yang Anda masukkan adalah Link Affiliate agar komisi masuk.</p>
            <div class="safety-check"><input type="checkbox" id="modalAffiliateCheck"><label for="modalAffiliateCheck">Saya menjamin link ini diambil dari menu <b>Affiliate / Share Product</b>.</label></div>
            <div class="modal-actions"><button onclick="closeConfirmModal()" class="btn-cancel-pass">Batal</button><button onclick="confirmUpload()" class="btn-save-pass">Upload</button></div>
        </div>
    </div>
    
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item"><i class="ph ph-house"></i><span>Home</span></a>
        <a href="products.html" class="nav-item"><i class="ph ph-grid-four"></i><span>Produk</span></a>
        <a href="cart.html" class="nav-item"><i class="ph ph-shopping-cart"></i><span>Troli</span></a>
        <a href="login.html" class="nav-item active"><i class="ph ph-user"></i><span>Admin</span></a>
    </nav>

    <script type="module">
        import { initAdminPage, updateProfile, submitProductData, saveBannerData, fetchBanners } from './js/modules/admin.js';
        initAdminPage();

        // Settings Modal
        window.openSettingsModal = () => { 
            document.getElementById('editEmail').value = localStorage.getItem('adminEmail') || '';
            document.getElementById('editWa1').value = localStorage.getItem('adminWa1') || '';
            document.getElementById('editWa2').value = localStorage.getItem('adminWa2') || '';
            document.getElementById('settingsModal').style.display = 'flex'; 
        };
        window.closeSettingsModal = () => { document.getElementById('settingsModal').style.display = 'none'; document.getElementById('newPassword').value = ''; };
        window.saveSettings = () => {
            const email = document.getElementById('editEmail').value;
            const wa1 = document.getElementById('editWa1').value;
            const wa2 = document.getElementById('editWa2').value;
            const pass = document.getElementById('newPassword').value;
            if(!email || !wa1) { alert('Email dan WA Utama wajib diisi!'); return; }
            if(pass.length > 0 && pass.length < 6) { alert('Password minimal 6 karakter!'); return; }
            updateProfile(email, wa1, wa2, pass);
        };

        // Banner Modal
        window.currentBanners = {};
        window.openBannerModal = async () => {
            document.getElementById('bannerModal').style.display = 'flex';
            window.currentBanners = await fetchBanners();
            loadBannerDataInModal();
        };
        window.closeBannerModal = () => { document.getElementById('bannerModal').style.display = 'none'; };
        window.loadBannerDataInModal = () => {
            const key = document.getElementById('bannerSelector').value;
            const data = window.currentBanners[key] || {};
            document.getElementById('bannerImage').value = data.imageUrl || '';
            document.getElementById('bannerTitle').value = data.title || '';
            document.getElementById('bannerSubtitle').value = data.subtitle || '';
            document.getElementById('bannerBtnText').value = data.linkText || '';
            const textField = document.getElementById('homeBannerTexts');
            if (key.includes('home')) textField.style.display = 'block'; else textField.style.display = 'none';
        };
        window.saveBanner = async () => {
            const key = document.getElementById('bannerSelector').value;
            const payload = {
                key: key, imageUrl: document.getElementById('bannerImage').value,
                title: document.getElementById('bannerTitle').value, subtitle: document.getElementById('bannerSubtitle').value,
                linkText: document.getElementById('bannerBtnText').value
            };
            if(!payload.imageUrl) { alert('URL Gambar wajib diisi!'); return; }
            await saveBannerData(payload); window.currentBanners[key] = payload;
        };

        // Affiliate Modal
        window.closeConfirmModal = () => { document.getElementById('confirmModal').style.display = 'none'; };
        window.confirmUpload = () => {
            const check = document.getElementById('modalAffiliateCheck');
            if(!check.checked) { alert('Mohon centang kotak konfirmasi!'); return; }
            submitProductData(); 
        };
    </script>
</body>
</html>